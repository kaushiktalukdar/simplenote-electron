(window.webpackJsonp=window.webpackJsonp||[]).push([[2,4],{365:function(t,e,n){"use strict";n.r(e),n.d(e,"NotePreview",(function(){return g}));var o=n(0),r=n.n(o),a=n(111),i=n(182),c=n(362),u=n.n(c),s=n(363),l=n.n(s),f=n(4),d={type:"output",regex:'<input type="checkbox" disabled',replace:'<input type="checkbox" '},p=function(t){return n.e(10).then(n.t.bind(null,888,7)).then((function(e){var n=e.default;n.extension("enableCheckboxes",d);var o=new n.Converter({extensions:["enableCheckboxes"]});o.setFlavor("github"),o.setOption("simpleLineBreaks",!1),o.setOption("ghMentions",!1),o.setOption("smoothLivePreview",!0);var r=t.replace(/([ \t\u2000-\u200a]*)\u2022(\s)/gm,"$1-$2");return function(t){for(var e=(new DOMParser).parseFromString(t,"text/html"),n=e.createTreeWalker(e.body,NodeFilter.SHOW_ALL,null,!1),o=[],r=[],a=function(){var t=n.currentNode;if(function(t){switch(t.nodeName.toLowerCase()){case"head":case"html":case"iframe":case"link":case"meta":case"object":case"script":case"style":return!0;default:return!1}}(t))return r.push(t),"continue";if(!function(t){var e=t.nodeName.toLowerCase();if("input"===e)return"checkbox"===t.getAttribute("type");switch(e){case"#text":case"a":case"article":case"b":case"br":case"blockquote":case"cite":case"code":case"dd":case"del":case"div":case"dt":case"em":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"hr":case"i":case"img":case"ins":case"kbd":case"li":case"ol":case"p":case"pre":case"s":case"span":case"strong":case"sub":case"sup":case"table":case"tbody":case"td":case"th":case"thead":case"tr":case"tt":case"ul":return!0;default:return!1}}(t))return o.push(t),"continue";var e=t.nodeName.toLowerCase();Object(f.filter)(t.attributes,(function(t){var n=t.name,o=t.value;return!function(t,e,n){switch(t){case"a":switch(e){case"href":return!n.toLowerCase().trim().startsWith("javascript");case"alt":case"rel":case"title":return!0;default:return!1}case"img":switch(e){case"alt":case"src":case"title":case"width":return!0;default:return!1}case"input":switch(e){case"disabled":case"checked":case"type":return!0;default:return!1}case"li":switch(e){case"class":switch(n){case"task-list-item":return!0;default:return!1}default:return!1}case"ol":switch(e){case"start":return!0;default:return!1}default:return!1}}(e,n,o)&&(("href"!==n&&"src"!==n||!l.a.isWebUri(o))&&("href"!==n||!o.startsWith("mailto:")||!u.a.validate(o.slice(7))))})).forEach((function(e){var n=e.name;return t.removeAttribute(n)}));var a="a"===e&&t.getAttribute("href");"a"!==e||"string"!=typeof a||a.startsWith("mailto:")||(t.setAttribute("target","_blank"),t.setAttribute("rel","external noopener noreferrer")),"li"===e&&"task-list-item"===t.getAttribute("class")&&t.setAttribute("style","list-style: none;")};n.nextNode();)a();return r.forEach((function(t){try{var e;null==t||null===(e=t.parentNode)||void 0===e||e.removeChild(t)}catch(t){}})),o.forEach((function(t){var e,n=t.parentNode;try{for(;e=t.firstChild;)null==n||n.insertBefore(e,t);null==n||n.removeChild(t)}catch(t){}})),e.body.innerHTML}(o.makeHtml(r))}))},h=function(t,e,o){return p(e).then((function(e){return t.innerHTML=e,t})).then((function(t){if(!o)return t.querySelectorAll("pre code");var e=Object(i.a)(o).map((function(t){return t.toLocaleLowerCase()}));if(!e.length)return t.querySelectorAll("pre code");for(var n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return e.some((function(e){var n;return null===(n=t.textContent)||void 0===n?void 0:n.toLocaleLowerCase().includes(e)}))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1),r=[],a=n.currentNode;a;)r.push(a),a=n.nextNode();return r.forEach((function(t){return function t(e,n){var o=e.parentNode;n.forEach((function(e){o.childNodes.forEach((function(o){var r,a,i;if(o.nodeType===Node.TEXT_NODE&&(null===(r=o.textContent)||void 0===r?void 0:r.toLocaleLowerCase().includes(e))){var c=null===(a=o.textContent)||void 0===a?void 0:a.toLocaleLowerCase().indexOf(e),u=o.splitText(c),s=u.splitText(e.length),l=document.createElement("span");l.setAttribute("class","search-match"),null===(i=u.parentNode)||void 0===i||i.replaceChild(l,u),l.appendChild(u),t(s,n)}}))}))}(t,e)})),t.querySelectorAll("pre code")})).then((function(t){if(t.length)return n.e(6).then(n.t.bind(null,887,7)).then((function(e){var n=e.default;t.forEach(n.highlightBlock)})).catch()}))},v=n(26),y=n(123);function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var g=function(t){var e=t.editNote,n=t.fontSize,a=t.isFocused,i=t.note,c=t.noteId,u=t.searchQuery,s=Object(o.useRef)();return Object(o.useEffect)((function(){var t=function(t){if(!a)return!0;if(!document.getSelection().isCollapsed)return!0;var e=document.createElement("div");h(e,i.content,u).then((function(){try{t.clipboardData.setData("text/plain",e.innerHTML)}catch(t){navigator.clipboard.writeText(e.innerHTML)}})),t.preventDefault()};return document.addEventListener("copy",t,!1),function(){return document.removeEventListener("copy",t,!1)}}),[a,u]),Object(o.useEffect)((function(){var t,n=function(t){for(var n=t.target;null!==n;n=n.parentNode){if("A"===i.tagName)return t.preventDefault(),t.stopPropagation(),void(n.href.startsWith("http://localhost")||Object(v.a)(n.href));if("task-list-item"===n.className){var o=function(){t.preventDefault(),t.stopPropagation();var o=s.current.querySelectorAll("[data-markdown-root] .task-list-item"),r=Array.prototype.indexOf.call(o,n),a=0,u=i.content.replace(/[\ue000|\ue001]/g,(function(t){return a++===r?""===t?"":"":t}));return e(c,{content:u}),{v:void 0}}();if("object"===m(o))return o.v}}};return null===(t=s.current)||void 0===t||t.addEventListener("click",n,!0),function(){var t;return null===(t=s.current)||void 0===t?void 0:t.removeEventListener("click",n,!0)}}),[]),Object(o.useEffect)((function(){s.current&&(null==i?void 0:i.content)&&(null==i?void 0:i.systemTags.includes("markdown"))&&h(s.current,i.content,u)}),[null==i?void 0:i.content,null==i?void 0:i.systemTags,u]),r.a.createElement("div",{className:"note-detail-wrapper"},r.a.createElement("div",{className:"note-detail"},r.a.createElement("div",{ref:s,className:"note-detail-markdown theme-color-bg theme-color-fg","data-markdown-root":!0,style:{fontSize:"".concat(n,"px")}},r.a.createElement("div",{style:{whiteSpace:"pre"}},null==i?void 0:i.content))))},b={editNote:y.a.data.editNote};e.default=Object(a.b)((function(t,e){var n,o;return{fontSize:t.settings.fontSize,isFocused:0===t.ui.dialogs.length&&!t.ui.showNoteInfo,note:null!==(n=e.note)&&void 0!==n?n:t.data.notes.get(e.noteId),noteId:null!==(o=e.noteId)&&void 0!==o?o:t.ui.openedNote,searchQuery:t.ui.searchQuery}}),b)(g)},892:function(t,e,n){"use strict";n.r(e),n.d(e,"NoteEditor",(function(){return Ft}));var o=n(0),r=n.n(o),a=n(111),i=n(871),c=n(4),u=n(264),s=n(127),l=Object(a.b)(null,(function(t){return{openShareDialog:function(){return t(Object(s.showDialog)("SHARE"))}}}))((function(t){var e=t.openShareDialog;return r.a.createElement("div",{className:"tag-email-tooltip"},r.a.createElement("div",{className:"tag-email-tooltip__arrow"}),r.a.createElement("div",{className:"tag-email-tooltip__inside"},"Collaboration has moved. Press the Share icon in the toolbar to access the ",r.a.createElement("a",{href:"#",onClick:e},"Collaborate screen"),"."))})),f=n(8),d=n.n(f),p=function(t){var e=t.onSelect,n=t.selected,o=t.tagName;return r.a.createElement("div",{className:d()("tag-chip",{selected:n}),"data-tag-name":o,onClick:e},o)};function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=T(t);if(e){var r=T(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return S(this,n)}}function S(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?E(t):e}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(i,t);var e,n,o,a=w(i);function i(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return m(this,i),O(E(t=a.call.apply(a,[this].concat(n))),"inputField",void 0),O(E(t),"inputObserver",void 0),O(E(t),"state",{isComposing:!1}),O(E(t),"completeSuggestion",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.identity,n=t.props,o=n.onChange,r=n.note,a=n.tags,i=n.value;if(i.length){var u,s=null,l=v(a.values());try{for(l.s();!(u=l.n()).done;){var f=u.value;if(!r.tags.includes(f.name)&&f.name.startsWith(i)){s=f.name;break}}}catch(t){l.e(t)}finally{l.f()}s&&o(s,(function(){e(s),t.focusInput()}))}})),O(E(t),"focusInput",(function(){if(t.inputField){var e=t.inputField;e.focus();var n=document.createRange();n.selectNodeContents(e),n.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}})),O(E(t),"hasFocus",(function(){return document.activeElement===t.inputField})),O(E(t),"interceptKeys",(function(e){var n;return Object(c.invoke)((O(n={},13,t.submitTag),O(n,188,t.submitTag),O(n,9,t.interceptTabPress),O(n,39,t.interceptRightArrow),n),e.keyCode,e)})),O(E(t),"interceptRightArrow",(function(e){var n=t.props.value;window.getSelection().getRangeAt(0).endOffset===n.length&&(t.completeSuggestion(),e.preventDefault(),e.stopPropagation())})),O(E(t),"interceptTabPress",(function(e){t.completeSuggestion(t.submitTag),e.preventDefault(),e.stopPropagation()})),O(E(t),"onInputMutation",(function(e){e.forEach((function(e){var n=Object(c.get)(e,"target.data","");"childList"===e.type&&e.addedNodes.length&&(n=Object(c.get)(e,"target.innerText","")),t.onInput(n)}))})),O(E(t),"onInput",(function(e){t.state.isComposing||t.props.onChange(e.trim(),t.focusInput)})),O(E(t),"onCompositionEnd",(function(e){var n=e.target.textContent;t.setState({isComposing:!1},(function(){return t.onInput(n)}))})),O(E(t),"removePastedFormatting",(function(e){var n;Object(c.get)(e,"clipboardData.getData")?n=e.clipboardData.getData("text/plain"):Object(c.get)(window,"clipboardData.getData")&&(n=window.clipboardData.getData("Text")),t.onInput(n),e.preventDefault(),e.stopPropagation()})),O(E(t),"storeInput",(function(e){t.inputField=e,t.props.inputRef(e),Object(c.invoke)(E(t),"inputField.addEventListener","paste",t.removePastedFormatting,!1)})),O(E(t),"submitTag",(function(e){var n=t.props,o=n.onSelect,r=n.value;r.trim().length&&o(r.trim()),Object(c.invoke)(e,"preventDefault"),Object(c.invoke)(e,"stopPropagation")})),t}return e=i,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusInput(this.focusInput),this.props.storeHasFocus(this.hasFocus),this.inputObserver=new MutationObserver(this.onInputMutation),this.inputObserver.observe(this.inputField,{characterData:!0,childList:!0,subtree:!0})}},{key:"componentWillUnmount",value:function(){Object(c.invoke)(this,"inputField.removeEventListener","paste",this.removePastedFormatting,!1),this.inputObserver.disconnect()}},{key:"render",value:function(){var t=this,e=this.props,n=e.note,o=e.tags,a=e.value,i=null;if(a.length>0){var c,u=v(o.values());try{for(u.s();!(c=u.n()).done;){var s=c.value;if(!n.tags.includes(s.name)&&s.name.startsWith(a)){i=s.name;break}}}catch(t){u.e(t)}finally{u.f()}}var l=""===a&&!this.state.isComposing;return r.a.createElement("div",{className:"tag-input",onClick:this.focusInput},l&&r.a.createElement("span",{"aria-hidden":!0,className:"tag-input__placeholder"},"Add a tag…"),r.a.createElement("div",{"aria-label":"Add a tag…",ref:this.storeInput,className:"tag-input__entry",contentEditable:"true",onCompositionStart:function(){return t.setState({isComposing:!0})},onCompositionEnd:this.onCompositionEnd,onKeyDown:this.interceptKeys,spellCheck:!1,suppressContentEditableWarning:!0},a),r.a.createElement("div",{className:"tag-input__suggestion",disabled:!0,type:"text"},i?i.substring(a.length):""))}}])&&g(e.prototype,n),o&&g(e,o),i}(o.Component);O(k,"displayName","TagInput"),O(k,"defaultProps",{inputRef:c.identity,onChange:c.identity,onSelect:c.identity,storeFocusInput:c.noop,storeHasFocus:c.noop});var F=Object(a.b)((function(t){return{note:t.data.notes.get(t.ui.openedNote),tags:t.data.tags}}))(k),N=n(9),j=n(174);function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=A(t);if(e){var r=A(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return R(this,n)}}function R(t,e){return!e||"object"!==I(e)&&"function"!=typeof e?x(t):e}function x(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var H=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&D(t,e)}(f,t);var e,n,a,s=P(f);function f(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return C(this,f),L(x(t=s.call.apply(s,[this].concat(n))),"container",Object(o.createRef)()),L(x(t),"focusInput",void 0),L(x(t),"hiddenTag",void 0),L(x(t),"inputHasFocus",void 0),L(x(t),"tagInput",Object(o.createRef)()),L(x(t),"state",{selectedTag:"",showEmailTooltip:!1,tagInput:""}),L(x(t),"addTag",(function(e){var n=t.props,o=n.note,r=n.noteId,a=e.trim().replace(/\s+/g,",").split(",");a.some(u.a)&&t.showEmailTooltip();var i=new Set(o.tags.map(j.a));a.forEach((function(e){i.has(Object(j.a)(e))||(i.add(Object(j.a)(e)),t.props.addTag(r,e))})),t.storeTagInput(""),Object(c.invoke)(x(t),"tagInput.focus"),N.a.tracks.recordEvent("editor_tag_added")})),L(x(t),"hasSelection",(function(){return t.state.selectedTag&&!!t.state.selectedTag.length})),L(x(t),"deleteTag",(function(e){var n=t.props.noteId,o=t.state.selectedTag;t.props.removeTag(n,e),o===e&&t.setState({selectedTag:""},(function(){var e,n;return null===(e=t.tagInput)||void 0===e||null===(n=e.current)||void 0===n?void 0:n.focus()})),N.a.tracks.recordEvent("editor_tag_removed")})),L(x(t),"deleteSelection",(function(){t.hasSelection()&&t.deleteTag(t.state.selectedTag)})),L(x(t),"hideEmailTooltip",(function(){return t.setState({showEmailTooltip:!1})})),L(x(t),"hasFocus",(function(){return!!t.inputHasFocus&&t.inputHasFocus()})),L(x(t),"focusTagField",(function(){return t.focusInput&&t.focusInput()})),L(x(t),"interceptKeys",(function(e){if(8===e.which){if(t.hasSelection()&&t.deleteSelection(),""!==t.state.tagInput)return;return t.selectLastTag(),void e.preventDefault()}if(39===e.which&&t.hasSelection())return t.unselect(e),void t.focusTagField();9===e.which&&t.hasSelection()&&t.unselect(e)})),L(x(t),"preventStealingFocus",(function(e){var n=e.ctrlKey,o=e.code,r=e.metaKey,a=e.shiftKey;if(t.props.keyboardShortcuts)return(n||r)&&a&&"KeyY"===o&&t.setState({selectedTag:""}),!0})),L(x(t),"selectLastTag",(function(){var e;return t.setState({selectedTag:null===(e=t.props.note)||void 0===e?void 0:e.tags.slice(-1).shift()})})),L(x(t),"selectTag",(function(e){var n=e.currentTarget.dataset.tagName;e.preventDefault(),e.stopPropagation(),t.deleteTag(n)})),L(x(t),"showEmailTooltip",(function(){t.setState({showEmailTooltip:!0}),setTimeout((function(){return t.setState({showEmailTooltip:!1})}),5e3)})),L(x(t),"onKeyDown",(function(e){return t.state.showEmailTooltip&&t.hideEmailTooltip(),t.interceptKeys(e)})),L(x(t),"storeFocusInput",(function(e){return t.focusInput=e})),L(x(t),"storeHasFocus",(function(e){return t.inputHasFocus=e})),L(x(t),"storeHiddenTag",(function(e){return t.hiddenTag=e})),L(x(t),"storeInputRef",(function(e){return t.tagInput=e})),L(x(t),"storeTagInput",(function(e,n){return t.setState({tagInput:e},n)})),L(x(t),"unselect",(function(e){var n;t.state.selectedTag&&(null===(n=t.hiddenTag)||void 0===n?void 0:n.current)!==e.relatedTarget&&t.setState({selectedTag:""})})),t}return e=f,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusTagField(this.focusTagField),this.props.storeHasFocus(this.hasFocus),document.addEventListener("click",this.unselect,!0),window.addEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.unselect,!0),window.removeEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentDidUpdate",value:function(){var t,e;this.hasSelection()&&(null===(t=this.hiddenTag)||void 0===t||null===(e=t.current)||void 0===e||e.focus())}},{key:"render",value:function(){var t=this,e=this.props.note,n=this.state,o=n.selectedTag,a=n.showEmailTooltip,s=n.tagInput;return r.a.createElement("div",{ref:this.container,className:"tag-field"},r.a.createElement("div",{className:d()("tag-editor",{"has-selection":this.hasSelection()}),tabIndex:-1,onKeyDown:this.onKeyDown},r.a.createElement("input",{className:"hidden-tag",tabIndex:-1,ref:this.storeHiddenTag}),null==e?void 0:e.tags.filter(Object(c.negate)(u.a)).map((function(e){return r.a.createElement(p,{key:e,tagName:e,selected:e===o,onSelect:t.selectTag})})),r.a.createElement(F,{inputRef:this.storeInputRef,value:s,onChange:this.storeTagInput,onSelect:this.addTag,storeFocusInput:this.storeFocusInput,storeHasFocus:this.storeHasFocus}),r.a.createElement(i.a,{container:this.container.current,onHide:this.hideEmailTooltip,placement:"top",rootClose:!0,shouldUpdatePosition:!0,show:a,target:this.tagInput.current},(function(){return r.a.createElement(l,null)}))))}}])&&_(e.prototype,n),a&&_(e,a),f}(o.Component);L(H,"displayName","TagField");var M=Object(a.b)((function(t){return{allTags:t.data.tags,keyboardShortcuts:t.settings.keyboardShortcuts,noteId:t.ui.openedNote,note:t.data.notes.get(t.ui.openedNote)}}),{addTag:function(t,e){return{type:"ADD_NOTE_TAG",noteId:t,tagName:e}},removeTag:function(t,e){return{type:"REMOVE_NOTE_TAG",noteId:t,tagName:e}}})(H),K=n(123),W=n(155);function U(t){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(o=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){r=!0,a=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw a}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=X(t);if(e){var r=X(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Y(this,n)}}function Y(t,e){return!e||"object"!==U(e)&&"function"!=typeof e?G(t):e}function G(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Z=function(t){return t.replace(/^(\s*)- \[ \](\s)/gm,"$1$2").replace(/^(\s*)- \[x\](\s)/gim,"$1$2")},tt=function(t){return t.replace(/\ue000/g,"- [ ]").replace(/\ue001/g,"- [x]")},et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(c,t);var e,n,a,i=J(c);function c(){var t;q(this,c);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return V(G(t=i.call.apply(i,[this].concat(n))),"editor",Object(o.createRef)()),V(G(t),"state",{content:"",editor:"fast",noteId:null,overTodo:!1}),V(G(t),"handleKeys",(function(e){if(t.props.keyboardShortcuts){var n=e.code,o=e.ctrlKey,r=e.metaKey,a=e.shiftKey;return!(o||r)||!a||"KeyC"!==n||(t.props.insertTask(),e.stopPropagation(),e.preventDefault(),!1)}})),V(G(t),"storeSelection",(function(e){var n=e.currentTarget,o=n.selectionStart,r=n.selectionEnd,a=n.selectionDirection;"fast"!==t.state.editor&&t.props.storeEditorSelection(t.props.noteId,o,r,a)})),V(G(t),"updateNote",(function(e){var n=t.props;(0,n.editNote)(n.noteId,{content:tt(e.currentTarget.value)})})),t}return e=c,a=[{key:"getDerivedStateFromProps",value:function(t,e){return t.noteId!==e.noteId?{content:Z(t.note.content.slice(0,t.editorSelection[1]+5e3)),editor:"fast",noteId:t.noteId}:t.note.content!==e.content?{content:Z(t.note.content)}:null}}],(n=[{key:"componentDidMount",value:function(){var t=this,e=this.props.noteId;window.addEventListener("keydown",this.handleKeys,!0),setTimeout((function(){e===t.props.noteId&&t.setState({editor:"full",content:Z(t.props.note.content)})}),120),this.editor.current.oncopy=function(t){var e=window.getSelection();if(t.clipboardData&&e){var n=tt(e.toString());try{t.clipboardData.setData("text/plain",n)}catch(t){navigator.clipboard.writeText(n)}t.preventDefault()}},this.editor.current.addEventListener("click",(function(){var e=t.props,n=(e.editNote,e.noteId,t.state.content);if(t.editor.current){var o=t.editor.current,r=o.selectionStart;if(r===o.selectionEnd){var a=r,i=""===n[a]||""===n[a],c=!i&&a>0&&(""===n[a-1]||""===n[a-1]);if(i||c){var u=i?a:a-1,s=""===n[u];t.editor.current.setSelectionRange(u,u+1,"forward"),document.execCommand("insertText",!1,s?"":"")}}}}),!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeys,!0)}},{key:"componentDidUpdate",value:function(t,e){var n=this,o=z(t.editorSelection,3),r=o[0],a=o[1],i=o[2],c=this.props,u=c.noteId,s=z(c.editorSelection,3),l=s[0],f=s[1],d=s[2];!this.editor.current||("full"!==this.state.editor||r===l&&a===f&&i===d)&&t.noteId===this.props.noteId&&e.editor===this.state.editor||(this.editor.current.setSelectionRange(l,f,d),this.editor.current.focus()),"fast"===this.state.editor&&setTimeout((function(){u===n.props.noteId&&n.setState({editor:"full",content:Z(n.props.note.content)})}),120)}},{key:"render",value:function(){var t=this.state,e=t.content,n=t.editor;return r.a.createElement("div",{className:"note-content-editor-shell"},r.a.createElement("textarea",{ref:this.editor,value:e,dir:"auto",onChange:this.updateNote,onSelect:this.storeSelection,readOnly:"fast"===n}))}}])&&Q(e.prototype,n),a&&Q(e,a),c}(o.Component),nt={editNote:K.a.data.editNote,insertTask:function(){return{type:"INSERT_TASK"}},storeEditorSelection:function(t,e,n,o){return{type:"STORE_EDITOR_SELECTION",noteId:t,start:e,end:n,direction:o}}},ot=Object(a.b)((function(t){var e;return{editorSelection:null!==(e=t.ui.editorSelection.get(t.ui.openedNote))&&void 0!==e?e:[0,0,"none"],fontSize:t.settings.fontSize,keyboardShortcuts:t.settings.keyboardShortcuts,noteId:t.ui.openedNote,note:t.data.notes.get(t.ui.openedNote),searchQuery:t.ui.searchQuery,spellCheckEnabled:t.settings.spellCheckEnabled,theme:W.a(t)}}),nt)(et),rt=n(258);function at(t){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ct(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function ut(t,e){return(ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function st(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=dt(t);if(e){var r=dt(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return lt(this,n)}}function lt(t,e){return!e||"object"!==at(e)&&"function"!=typeof e?ft(t):e}function ft(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dt(t){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ut(t,e)}(c,t);var e,n,a,i=st(c);function c(){var t;it(this,c);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return pt(ft(t=i.call.apply(i,[this].concat(n))),"noteDetail",Object(o.createRef)()),pt(ft(t),"focusEditor",(function(){return t.focusContentEditor&&t.focusContentEditor()})),pt(ft(t),"hasFocus",(function(){var e,n;return null===(e=(n=t).editorHasFocus)||void 0===e?void 0:e.call(n)})),pt(ft(t),"storeEditorHasFocus",(function(e){return t.editorHasFocus=e})),pt(ft(t),"storeFocusContentEditor",(function(e){return t.focusContentEditor=e})),t}return e=c,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus)}},{key:"render",value:function(){var t=this.props,e=t.fontSize,n=t.openedNote;return r.a.createElement("div",{className:"note-detail-wrapper"},n?r.a.createElement("div",{ref:this.noteDetail,className:"note-detail"},r.a.createElement("div",{className:"note-detail-textarea theme-color-bg theme-color-fg",style:{fontSize:"".concat(e,"px"),overflowY:"hidden"}},r.a.createElement(ot,{storeFocusEditor:this.storeFocusContentEditor,storeHasFocus:this.storeEditorHasFocus}))):r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(rt.a,null)))}}])&&ct(e.prototype,n),a&&ct(e,a),c}(o.Component);pt(ht,"displayName","NoteDetail");var vt=Object(a.b)((function(t){return{fontSize:t.settings.fontSize,isDialogOpen:t.ui.dialogs.length>0,keyboardShortcuts:t.settings.keyboardShortcuts,openedNote:t.ui.openedNote}}))(ht),yt=n(365);function mt(t){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function wt(t,e){return(wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function St(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=Ot(t);if(e){var r=Ot(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Et(this,n)}}function Et(t,e){return!e||"object"!==mt(e)&&"function"!=typeof e?Tt(t):e}function Tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ot(t){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ft=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wt(t,e)}(i,t);var e,n,o,a=St(i);function i(){var t;gt(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(Tt(t=a.call.apply(a,[this].concat(n))),"markdownEnabled",(function(){var e;return null===(e=t.props.note)||void 0===e?void 0:e.systemTags.includes("markdown")})),kt(Tt(t),"handleShortcut",(function(e){if(t.props.keyboardShortcuts){var n,o,r,a,i=e.code,c=e.ctrlKey,u=e.metaKey,s=e.shiftKey,l=t.props,f=l.note,d=l.noteId,p=l.toggleMarkdown,h=c||u;return f&&h&&s&&"KeyM"===i?(console.log("toggling markdown"),p(d,!t.markdownEnabled()),e.stopPropagation(),e.preventDefault(),!1):h&&s&&"KeyP"===i&&t.markdownEnabled()?(t.props.toggleEditMode(),e.stopPropagation(),e.preventDefault(),!1):!(s&&h&&"KeyY"===i&&t.props.isEditorActive)||(t.editFieldHasFocus()?(null===(n=(o=t).focusTagField)||void 0===n||n.call(o),e.stopPropagation(),e.preventDefault(),!1):(null===(r=(a=t).focusNoteEditor)||void 0===r||r.call(a),e.stopPropagation(),e.preventDefault(),!1))}})),kt(Tt(t),"editFieldHasFocus",(function(){return t.editorHasFocus&&t.editorHasFocus()})),kt(Tt(t),"storeEditorHasFocus",(function(e){return t.editorHasFocus=e})),kt(Tt(t),"storeFocusEditor",(function(e){return t.focusNoteEditor=e})),kt(Tt(t),"storeFocusTagField",(function(e){return t.focusTagField=e})),kt(Tt(t),"storeTagFieldHasFocus",(function(e){return t.tagFieldHasFocus=e})),kt(Tt(t),"tagFieldHasFocus",(function(){return t.tagFieldHasFocus&&t.tagFieldHasFocus()})),kt(Tt(t),"toggleShortcuts",(function(e){e?window.addEventListener("keydown",t.handleShortcut,!0):window.removeEventListener("keydown",t.handleShortcut,!0)})),t}return e=i,(n=[{key:"componentDidMount",value:function(){var t=this;this.toggleShortcuts(!0),this.timer=setInterval((function(){var e;return null==t||null===(e=t.forceUpdate)||void 0===e?void 0:e.call(t)}),1e3)}},{key:"componentWillUnmount",value:function(){this.toggleShortcuts(!1),clearTimeout(this.timer)}},{key:"render",value:function(){var t=this.props,e=t.editMode,n=t.lastUpdated,o=t.note,a=t.noteId;if(!o)return r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(rt.a,null));var i=!!o.deleted;return r.a.createElement("div",{className:"note-editor theme-color-bg theme-color-fg"},r.a.createElement("div",null,"Note last updated: ",Math.floor((Date.now()-n)/1e3),"s ago (",new Date(n).toLocaleTimeString(),")"),e||!o.systemTags.includes("markdown")?r.a.createElement(vt,{storeFocusEditor:this.storeFocusEditor,storeHasFocus:this.storeEditorHasFocus}):r.a.createElement(yt.default,{noteId:a}),o&&!i&&r.a.createElement(M,{storeFocusTagField:this.storeFocusTagField,storeHasFocus:this.storeTagFieldHasFocus}))}}])&&bt(e.prototype,n),o&&bt(e,o),i}(o.Component);kt(Ft,"displayName","NoteEditor");var Nt={toggleNoteList:K.a.ui.toggleNoteList,toggleMarkdown:K.a.data.markdownNote,toggleEditMode:K.a.ui.toggleEditMode};e.default=Object(a.b)((function(t){return{allTags:t.data.tags,editMode:t.ui.editMode,keyboardShortcuts:t.settings.keyboardShortcuts,isEditorActive:!t.ui.showNavigation,lastUpdated:t.simperium.lastSync.get(t.ui.openedNote),noteId:t.ui.openedNote,note:t.data.notes.get(t.ui.openedNote),revision:t.ui.selectedRevision,isSmallScreen:W.b(t)}}),Nt)(Ft)}}]);